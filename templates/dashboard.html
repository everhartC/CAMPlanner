{% extends 'base.html' %}
{% load static %}
    <title>{% block title %}{{request.session.name}}'s Dashboard{% endblock title %}</title>
    <link rel="stylesheet" href="{% static 'css/myStyles.css' %}">
    <style>
        ul.no-bullets {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
    </style>
{% load widget_tweaks %}
{% block content %}
    <div class="tile is-ancestor">
        <div class="tile is-parent is-vertical is-7">
            <div class="tile is-child has-background-light box">
                <h2 class="subtitle mt-4">Your Recent Trips</h2>
                <div class="table-container mb-5">
                    <table id="rtrips" class="table is-striped is-bordered is-hoverable is-fullwidth">
                        <thead>
                            <tr class="is-selected">
                                <th class="is-success">Trip</th>
                                <th class="is-success">Coordinator</th>
                                <th class="is-success">Start Date</th>
                                <th class="is-success">End Date</th>
                                <th class="is-success">Participants</th>
                                <th class="is-success">Created At</th>
                            </tr>
                        </thead>
                        <tbody>
                        {% if mytrips%}
                            {% for trip in mytrips %}
                            <tr>
                                <td><a href="/dashboard/trip/{{trip.id}}">{{trip.name}}</a></td>
                                <td>{{trip.creator.fname}}</td>
                                <td>{{trip.start_date}}</td>
                                <td>{{trip.end_date}}</td>
                                <td>
                                
                                {% for users in trip.participants.all %}
                                    {% if users %}
                                        <ul class="no-bullets"><li>{{users.fname}}</li></ul>
                                    {% endif %}
                                {% endfor %}
                                {% if not trip.participants.all %}
                                    <ul class="no-bullets"><li>No Participants</li></ul>
                                {% endif %}
                                </td>
                                <td>{{trip.created_at}}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>You haven't been on any trips yet</tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="tile is-child is-success box has-background-light">
                <article class="message is-success">
                    <div class="message-header">
                        <h2 class="subtitle has-text-dark">Add a New Trip!</h2>
                    </div>
                </article>
                <form action="/dashboard/addTrip" method="post">
                {% csrf_token %}
                    <div class="columns mt-4">
                    {% for field in tripform %}
                        {% if field.name %}
                            <div class="column is-one-quarter">
                                <label class="label" for="{{field.id_for_label}}">{{field.label}}</label>
                                {{field|add_class:'form-control'}}
                            </div>
                        {% else %}
                        <div class="column">
                            <label class="label" for="{{field.id_for_label}}">{{ field.label }}</label>
                            {{field|add_class:'form-control'}}
                        </div>
                        {% endif %}
                    {% endfor %}
                    </div>
                    <div class="field">
                        <div class="control">
                            <input class="button is-success" type="submit" value="Add Trip">
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="tile is-parent is-vertical is-5 mt-4 has-background-light">
            <h2 class="subtitle mt-4">Recent Messages</h2>
            {% for msg in allmsgs %}
                <article class="message is-success">
                    <div class="message-header">
                        <strong>Trip: {{msg.trip}}</strong>
                        <br>
                        <strong>Posted by: {{msg.user_who_posted}}</strong>
                        
                        {% if this_user.id == msg.user_who_posted.id %}
                            <button class="delete" aria-label="delete" id="dbtn" onclick="window.location.href='/dashboard/user/{{this_user.id}}/deleteMsg/{{msg.id}}'"></button>
                        {% endif %}
                    </div>
                    <div class="message-body">
                        <em "margin-bottom: 4px;">{{msg.created_at}}</em>
                        <p style="margin-top: 8px;">{{msg.msg}}</p>
                    </div>
                </article>
            {% endfor %}
        </div>
    </div>
{% endblock content %}

